"use strict";(self.webpackChunknritya_webApp=self.webpackChunknritya_webApp||[]).push([[1018],{81018:(e,t,a)=>{a.d(t,{Z:()=>w});var s=a(72791),c=a(6429),n=a.n(c),o=a(30276),l=a(10159),i=a(59434),r=a(60717),d=a(68449),m=a(57621),g=a(13400),u=a(39504),f=a(27247),h=a(75424),x=a(83708),y=a(56510),p=a(80184);const j=(0,s.forwardRef)(((e,t)=>{let{entityId:a,storageFolder:c,title:j,maxImageCount:w=10,minImageCount:b,updateMode:v,disable:N}=e;const{setIsLoading:C}=(0,y.U)(),k=(0,h.D)(),I=(0,s.useRef)(null),[U,F]=(0,s.useState)([]),[M,E]=(0,s.useState)([]),[B,H]=(0,s.useState)([]),R=(0,i.v9)(r.w),[D,O]=(0,s.useState)(-1),[S,A]=(0,s.useState)(-1),[J,L]=(0,s.useState)(!1);console.log("Kyc enitity id ",a,N);const P=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;if(0===e)return"0 Bytes";const a=t<0?0:t,s=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,s)).toFixed(a))+" "+["Bytes","KB","MB","GB","TB","PB","EB","ZB","YB"][s]};(0,s.useEffect)((()=>{a&&T(a)}),[a]),(0,s.useEffect)((()=>{if(w&&U.length>w){const e=U.slice(0,w);alert("Exceeded maxImageCount, keeping first ".concat(w," files.")),I.current.value=null,F(e)}}),[U,w]);const Z=(e,t)=>{const a=e.map((e=>e.id)),s=t.map((e=>e.id));return{imagesToDelete:t.filter((e=>!a.includes(e.id))),newImages:e.filter((e=>!s.includes(e.id)))}},T=async e=>{F([]),H([]);try{const t="".concat(c,"/").concat(e);console.log(t);const a=(0,o.iH)(l.tO,t),s=await(0,o.aF)(a),n=await Promise.all(s.items.map((async e=>{const t=await(0,o.Jt)(e);return{id:e.name,filename:e.name,fileURL:t}})));E(n),F(n)}catch(t){console.error("Error fetching user images:",t)}};return(0,s.useImperativeHandle)(t,(()=>({isValid:()=>0===b||J}))),(0,p.jsx)("div",{className:"fileupload-view",style:{display:"flex",width:"100%",justifyContent:"center"},children:(0,p.jsx)("div",{className:"row justify-content-center m-0",style:{flex:"1",justifyContent:"center"},children:(0,p.jsx)("div",{className:"col-md-6",style:{flex:"1",justifyContent:"center"},children:(0,p.jsx)("div",{className:"card mt-5",children:(0,p.jsxs)("div",{className:"card-body",style:{backgroundColor:R?"#333333":"white"},children:[(0,p.jsxs)("div",{className:"kb-data-box",children:[(0,p.jsx)("div",{className:"kb-modal-data-title",children:(0,p.jsxs)("div",{className:"kb-data-title",style:{justifyContent:"center",flex:"1"},children:[(0,p.jsx)("h4",{children:j}),(0,p.jsxs)("p",{children:["Max no of image(s):",w," ",c===x.Rb.STUDIOIMAGES&&(0,p.jsx)("p",{children:"Add at least 5 images"})]})]})}),(0,p.jsxs)("div",{style:{backgroundColor:R?"#333333":"white"},children:[(0,p.jsx)("div",{className:"kb-file-upload",children:(0,p.jsx)("div",{className:"file-upload-box",children:(0,p.jsx)("input",{ref:I,type:"file",id:"fileupload",className:"file-upload-input",onChange:e=>{const t=Array.from(e.target.files),a=[];t.forEach((e=>{const s=new FileReader;s.onloadend=()=>{a.push({id:n().generate(),filename:e.name,filetype:e.type,fileimage:s.result,datetime:e.lastModifiedDate.toLocaleString("en-IN"),filesize:P(e.size),file:e}),a.length===t.length&&(F((e=>[...e,...a])),H(a),I.current.value=null)},s.readAsDataURL(e)}))},multiple:!0})})}),(0,p.jsx)("br",{}),(0,p.jsx)("div",{className:"kb-attach-box mb-3",children:(0,p.jsx)("div",{className:"row",children:a&&U.length>0?U.map((e=>(0,p.jsx)("div",{className:"col-6 col-md-3 mb-3",style:{position:"relative"},children:(0,p.jsx)(m.Z,{sx:{maxWidth:345},children:e.filename.match(/\.(jpg|jpeg|png|gif|svg)$/i)?(0,p.jsxs)("div",{style:{position:"relative"},children:[(0,p.jsx)("img",{src:e.fileimage?e.fileimage:e.fileURL,alt:e.filename,className:"card-img-top",style:{maxHeight:"150px",objectFit:"cover"}}),(0,p.jsx)(g.Z,{"aria-label":"delete",disabled:N,onClick:()=>{return t=e.id,void(window.confirm("Are you sure you want to delete this image?")&&F((e=>e.filter((e=>e.id!==t)))));var t},style:{position:"absolute",top:0,right:0,backgroundColor:"rgba(255, 255, 255, 0.5)"},children:(0,p.jsx)(f.Z,{style:{color:"ff0000"}})})]}):(0,p.jsx)(u.Z,{children:(0,p.jsx)("i",{className:"far fa-file-alt"})})})},e.id))):(0,p.jsx)("div",{className:"col-12 text-center",children:(0,p.jsx)("p",{children:"No images selected"})})})}),(0,p.jsx)("div",{className:"kb-buttons-box",children:(0,p.jsx)("button",{type:"button",className:"btn div-submit",style:{backgroundColor:R?"#892CDC":"black",color:"white"},onClick:async()=>{if(a){O(-1),A(-1);try{if(C(!0),1===w&&U.length>=b)await(0,d.ih)(c,a),await(0,d.eg)(c,B,a,A),k("Image uploaded successfully","success"),L(!0);else{const{imagesToDelete:e,newImages:t}=Z(U,M);if(b&&t.length<b)return void k("Minimum ".concat(b," image(s) are required"),"error");e.length>0&&(await(0,d.xR)(c,e,a,O),k("Image(s) deleted successfully","success")),t.length>0&&(await(0,d.eg)(c,t,a,A),k("Image(s) uploaded successfully","success")),L(!0)}I.current.value=null}catch(e){L(!1),console.error("Error uploading/deleting images:",e)}finally{C(!1)}}else alert("No studio selected")},disabled:N,children:"Image Upload"})})]}),U.length>0&&(0,p.jsx)("div",{className:"kb-attach-box",hidden:!0,children:(0,p.jsxs)("div",{className:"row",children:[(0,p.jsx)("hr",{}),U.map((e=>(0,p.jsx)("div",{className:"col-6 col-md-3 mb-3",children:(0,p.jsx)("div",{className:"card",children:e.filename.match(/\.(jpg|jpeg|png|gif|svg)$/i)?(0,p.jsx)("img",{src:e.fileimage,alt:e.filename,className:"card-img-top",style:{maxHeight:"150px",objectFit:"cover"}}):(0,p.jsx)("div",{className:"card-body",children:(0,p.jsx)("i",{className:"far fa-file-alt"})})})},e.id)))]})})]}),D>=0&&(0,p.jsxs)("div",{children:[(0,p.jsxs)("p",{style:{color:R?"#fff":"#000"},children:["Deleting images... ",D.toFixed(2),"%"]}),(0,p.jsxs)("progress",{value:D,max:"100",style:{color:R?"#fff":"#000"},children:[D.toFixed(2),"%"]})]}),S>=0&&(0,p.jsxs)("div",{children:[(0,p.jsxs)("p",{style:{color:R?"#fff":"#000"},children:["Uploading images... ",S.toFixed(2),"%"]}),(0,p.jsxs)("progress",{value:S,max:"100",style:{color:R?"#fff":"#000"},children:[S.toFixed(2),"%"]})]})]})})})})})}));j.defaultProps={maxImageCount:5,updateMode:!1,disable:!1};const w=j},68449:(e,t,a)=>{a.d(t,{FV:()=>b,Km:()=>x,Ld:()=>g,Us:()=>m,XG:()=>v,Xt:()=>h,eg:()=>w,gG:()=>d,gY:()=>r,gv:()=>u,ih:()=>y,oM:()=>i,qS:()=>p,to:()=>f,xR:()=>j});var s=a(12481),c=a(10159),n=a(30276),o=a(83708),l=a(644);const i=async e=>{const t=o.A3,a="".concat(t,"crud/getUserMode/").concat(e);try{const e=await fetch(a),t=await e.json();if(t.success){let e=!1;!0===t.data&&(e=!0),l.Z.setItem("CreatorMode",e)}else console.log("Error: ",t.message||"Unknown error")}catch(s){console.log("Error fetching user mode: ",s),l.Z.setItem("CreatorMode",!1)}},r=async(e,t,a)=>{const s=o.A3;try{const c="".concat(s,"crud/").concat(e,"/").concat(t,"/");console.log(c);const n=await fetch(c),o=await n.json();o.success?a(o.data):console.error("Error fetching ".concat(t,":"),o.error)}catch(c){console.error("Error fetching ".concat(t,":"),c)}},d=async e=>(await i(e),await(async()=>{try{const e=l.Z.getItem("CreatorMode");return console.log("getCreatorMode ",e),e||!1}catch(e){return console.log(" error"),!1}})()),m=async(e,t)=>{console.log("Debug ","".concat(e,"/").concat(t));const a="".concat(e,"/").concat(t),s=(0,n.iH)(c.tO,a);try{const e=await(0,n.aF)(s);if(e.items.length>0){const t=e.items[0],a=await(0,n.Jt)(t);return console.log("Debug URL:",a),a}return console.log("Debug No files found in the folder."),null}catch(o){return console.error("Error getting image URL:",o),null}},g=async(e,t)=>{const a=(0,s.JU)(c.db,e,t),n=await(0,s.QT)(a);return n.exists()?n.data():null},u=async(e,t,a)=>{const n=(0,s.JU)(c.db,e,t);return await(0,s.pl)(n,a,{merge:!0}),a},f=async(e,t,a)=>{const n=(0,s.JU)(c.db,e,t);return await(0,s.r7)(n,{isPhoneNumberVerified:!0,phoneNumber:a}),!0},h=async(e,t,a)=>{const n=(0,s.JU)(c.db,e,t);return await(0,s.r7)(n,a),{id:t,...a}},x=async(e,t,a,n)=>{console.log("Hiii ",e,t,a,n);const o=(0,s.IO)((0,s.hJ)(c.db,e),(0,s.ar)(t,a,n));return(await(0,s.Yp)(o)).data().count},y=async(e,t)=>{const a="".concat(e,"/").concat(t),s=(0,n.iH)(c.tO,a),o=await(0,n.aF)(s);await Promise.all(o.items.map((async e=>{await(0,n.oq)(e)})))},p=async(e,t,a)=>{const s="".concat(e,"/").concat(t,"/").concat(a),o=(0,n.iH)(c.tO,s),l=await(0,n.aF)(o);await Promise.all(l.items.map((async e=>{await(0,n.oq)(e)})))},j=async function(e,t,a,s){let o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;const l=t.length;let i=0;await Promise.all(t.map((async t=>{let r="".concat(e,"/").concat(a,"/").concat(t.filename);o&&(r="".concat(e,"/").concat(a,"/").concat(o,"/").concat(t.filename));const d=(0,n.iH)(c.tO,r);await(0,n.oq)(d),i+=1,s(i/l*100)})))},w=async function(e,t,a,s){let o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;console.log(e,a);const l=t.length;let i=0;await Promise.all(t.map((async t=>{let r="".concat(e,"/").concat(a);o&&(r="".concat(e,"/").concat(a,"/").concat(o));const d=(0,n.iH)(c.tO,"".concat(r,"/").concat(t.file.name));await(0,n.KV)(d,t.file),i+=1,s(i/l*100)})))},b=async function(e,t,a){let s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,o=arguments.length>4?arguments[4]:void 0,l=arguments.length>5?arguments[5]:void 0,i="".concat(e,"/").concat(a);s&&(i="".concat(e,"/").concat(a,"/").concat(s)),console.log(t,t.name);const r=(0,n.iH)(c.tO,"".concat(i,"/").concat(t.name)),d=(0,n.B0)(r,t);d.on("state_changed",(e=>{const t=e.totalBytes,a=e.bytesTransferred,s=t>0?(a/t*100).toFixed(2):-1;switch(o(s),console.log("Upload is "+s+"% done"),e.state){case"paused":console.log("Upload is paused");break;case"running":console.log("Upload is running")}}),(e=>{e.code}),(()=>{(0,n.Jt)(d.snapshot.ref).then((e=>{console.log("File available at",e),l(e)}))}))},v=async e=>{const t="".concat(e),a=(0,n.iH)(c.tO,t);try{const e=await(0,n.aF)(a);return await Promise.all(e.items.map((async e=>{const t=await(0,n.Jt)(e);return{id:e.name,filename:e.name,fileURL:t}})))}catch(s){throw console.error("Error retrieving images:",s),s}}}}]);
//# sourceMappingURL=1018.d7ea0b8c.chunk.js.map